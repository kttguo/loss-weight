# 减肥网站项目 README

## 项目目标
本项目旨在开发一个减肥网站，帮助用户管理他们的减肥计划，提供视频播放功能，并存储用户信息。网站将部署在 GitHub Pages 上，确保用户可以方便地访问。

## 功能说明

### 1. 主食、肉蛋奶摄取量
- **用途**: 计算用户每日应摄取的三大营养素（碳水化合物、蛋白质、脂肪）量。
- **实现方式**: 用户输入相关信息后，点击计算按钮，弹出表单进行计算，并将结果存储到本地存储中。

- **基础代谢率（BMR）和身体质量指数（BMI）计算**:
- **用途**: 根据用户的BMR和BMI，计算每日应摄取的三大营养素（碳水化合物、蛋白质、脂肪）以及具体食物的摄入量。
- **实现方式**: 
  1. 计算标准体重 = 身高（厘米） - 105。
  2. 根据活动量计算每日所需能量：
     - 轻体力劳动者: 每千克耗能 30 千卡。
     - 中体力劳动者: 每千克耗能 35 千卡。
     - 重体力劳动者: 每千克耗能 40 千卡。
  3. 每日所需能量 = 标准体重 × 每千克所需能量。
  4. 根据每日所需能量计算三大营养素的克数：
     - 碳水化合物: 占总能量的 55%。
     - 蛋白质: 占总能量的 15%。
     - 脂肪: 占总能量的 30%。
  5. 每克产生的能量：
     - 碳水化合物: 每克 4 千卡。
     - 蛋白质: 每克 4 千卡。
     - 脂肪: 每克 9 千卡。

### 2. 记录摄入的食物卡路里含量
- **用途**: 记录用户每日摄入的食物及其卡路里含量。
- **实现方式**: 用户输入食物名称和数量，系统查询食物营养库并返回结果，计算总热量以及碳水化合物、蛋白质和脂肪的摄入量。

#### 实现步骤
1. **建立食物营养库**: 创建一个 JSON 文件（如 `foodNutrition.json`），存储常见食物的营养成分数据，包括每种食物的卡路里、碳水化合物、蛋白质和脂肪含量。
2. **用户输入**: 在前端创建一个输入框，允许用户输入食物名称和数量。
3. **查询功能**: 使用 JavaScript 加载 `foodNutrition.json` 文件并根据用户输入的食物名称查询相应的营养成分。
4. **计算总量**: 根据用户输入的食物数量，计算出总热量和三大营养物质的摄入量。
5. **显示结果**: 在页面上显示计算结果，包括总热量和三大营养物质的摄入量。

### 3. 运动视频
- **用途**: 提供运动视频，帮助用户进行锻炼。
- **实现方式**: 按照运动类型分类展示视频，以卡片形式呈现，用户可以播放视频并输入自定义链接。

#### 实现方案
- 使用 JSON 存储视频链接并在页面上显示运动视频。通过加载 JSON 文件，提取视频链接并嵌入到页面中，用户可以直接观看相关运动视频。

#### 运动视频分类
- **热身**: 包含适合运动前的热身活动，帮助身体逐渐适应运动强度，减少受伤风险。
- **核心**: 专注于核心肌群的锻炼，增强腹部、背部和骨盆区域的力量和稳定性。
- **有氧**: 提高心肺功能的运动，通常包括较高强度的活动，适合燃脂和提高耐力。
- **力量**: 增强肌肉力量和耐力的训练，包括举重、哑铃练习等。
- **拉伸**: 运动后的拉伸活动，帮助放松肌肉，增加柔韧性，促进恢复。

#### 视频卡片应包含的信息
- **视频占位符**: 包裹视频缩略图和视频占位符，在这个区域内点击即可实现在视频播放器中播放视频。
- **视频缩略图**: 显示视频的缩略图，点击图片视频播放器即可播放视频。
- **视频播放器**: 嵌入Bilibili视频播放器，点击该区域就会播放视频
- **视频标题**: 简洁明了的标题，描述视频的内容。
- **描述**: 简短的描述，提供更多关于视频内容的信息。
- **播放按钮**: 个明显的播放按钮，用户点击后可以直接播放视频。
- **分类标签** (可选): 显示视频所属的运动类型（如热身、有氧、力量训练等），帮助用户快速筛选。

#### 视频链接存储
- 将不超过 20 个运动视频的链接存储在 JSON 文件中，并将这些链接处理成两种模式：
  - **API 模式的链接**: 用于获取视频的元数。
  - **只播放视频模式的链接**: 直接指向视频的播放页面。

### 批量处理 Bilibili 视频链接的步骤

1. **准备视频链接**: 收集需要处理的多个 Bilibili 视频链接，确保每个链接都包含视频 ID。

2. **提取 BVID**: 从视频链接中提取 BVID。BVID 是视频的唯一标识符，您可以通过解析 URL 来获取它。

3. **构建 API 请求**: 使用提取的 BVID 构建 API 请求 URL，例如：
   ```
   https://api.bilibili.com/x/web-interface/view?bvid=BV1w4411a7Bm
   ```

4. **发送请求并处理响应**:
   - 使用 `fetch` 方法发送请求到 Bilibili API。
   - 从响应中提取所需的数据，包括 `pic`、`title`、`desc`、`duration` 和 `pages` 字段中的 `part`。

5. **保存数据到 JSON 文件**: 将提取到的视频信息（包括标题、描述、缩略图、时长和分类）写入 `videos.json` 文件中，以便后续使用。

6. **动态生成视频卡片**: 在网页上根据 `videos.json` 中的数据动态生成视频卡片，展示视频信息，用户可以直接播放视频。

### 示例代码

以下是一个示例代码，展示如何批量处理视频链接并提取所需信息：

```javascript
const videoLinks = [
    "https://www.bilibili.com/video/BV1w4411a7Bm?spm_id_from=333.788.videopod.episodes&vd_source=115cb9da5209afde3727be34de4a41ef&p=2",
    "https://www.bilibili.com/video/BV1w4411a7Bm?spm_id_from=333.788.videopod.episodes&vd_source=115cb9da5209afde3727be34de4a41ef&p=3",
    "https://www.bilibili.com/video/BV1w4411a7Bm?spm_id_from=333.788.videopod.episodes&vd_source=115cb9da5209afde3727be34de4a41ef&p=4",
    "https://www.bilibili.com/video/BV1w4411a7Bm?spm_id_from=333.788.videopod.episodes&vd_source=115cb9da5209afde3727be34de4a41ef&p=5",
    "https://www.bilibili.com/video/BV1w4411a7Bm?spm_id_from=333.788.videopod.episodes&vd_source=115cb9da5209afde3727be34de4a41ef&p=6"
];

const videos = videoLinks.map(link => {
    const bvid = link.split('/video/')[1].split('?')[0]; // 提取视频 ID
    return {
        title: `视频标题 ${bvid}`, // 这里可以根据需要设置标题
        apiUrl: `https://api.bilibili.com/x/web-interface/view?bvid=${bvid}`,
        playUrl: link,
        playUrlAPI: `https://player.bilibili.com/player.html?bvid=${bvid}`,
        description: `描述 ${bvid}`, // 这里可以根据需要设置描述
        category: "健身", // 根据需要设置分类
        duration: "15:00", // 这里可以根据需要设置长
        thumbnail: `https://i0.hdslb.com/bfs/archive/xxxxxx.jpg` // 这里可以根据需要设置缩略图
    };
});

// 将生成的 videos 数组存储到 JSON 文件中
console.log(JSON.stringify(videos, null, 2)); // 打印 JSON 数据 ß
```


### 4. 私教功能（AI 生成运动视频）
- **用途**: 提供用户需要的运动视频，AI 教练可以隔着屏幕与用户交流，纠正用户动作并陪伴用户。
- **实现方式**:
  - **视频通话功能**: 使用 WebRTC 技术实现实时视频通话，允许用户与 AI 教练进行互动。
  - **AI 动作识别**: 使用计算机视觉和机器学习技术识别用户的动作，并提供实时反馈。
  - **用户界面设计**: 在用户界面中添加视频窗口，显示用户的实时视频和 AI 教练的反馈信息。
  - **后端支持**: 需要一个后端服务器来处理用户的注册、登录、视频流的信号交换等。

### 5. 社交功能
- **用途**: 提供用户交流的平台，参考豆瓣小组的功能。
- **实现方式**: 创建讨论区，用户可以发布和回复帖子，分享减肥经验。社交数据将存储在本地存储中。

### 6. 基础代谢率（BMR���和身体质量指数（BMI）计算
- **用途**: 根据用户的BMR和BMI，计算每日应摄取的三大营养素（碳水化合物、蛋白质、脂肪）以及具体食物的摄入量。
- **实现方式**: 
  1. 计算标准体重 = 身高（厘米） - 105。
  2. 根据活动量计算每日所需能量：
     - 轻体力劳动者: 每千克耗能 30 千卡。
     - 中体力劳动者: 每千克耗能 35 千卡。
     - 重体力劳动者: 每千克耗能 40 千卡。
  3. 每日所需能量 = 标准体重 × 每千克所需能量。
  4. 根据每日所需能量计算三大营养素的克数：
     - 碳水化合物: 占总能量的 55%。
     - 蛋白质: 占总能量的 15%。
     - 脂肪: 占总能量的 30%。
  5. 每克产生的能量：
     - 碳水化合物: 每克 4 千卡。
     - 蛋白质: 每克 4 千卡。
     - 脂肪: 每克 9 千卡。
  6. **运动量计算**: 
     - 用户选择活动水平（轻体力、中体力、重体力），根据选择的活动水平调整每日所需能量。

### 7. 每日真实摄入的卡路里含量计算
- **用途**: 计算用户每日实际摄入的卡路里及其营养成分。
- **实现方式**:
  1. 用户输入食物名称和数量。
  2. 系统查询食物营养库（`foodNutrition.json`）以获取相应的营养成分。
  3. 计算总卡路里、碳水化合物、蛋白质和脂肪的摄入量。
  4. 在页面上显示计算结果。

#### 示例代码

```javascript
async function loadFoodNutrition() {
    const response = await fetch('./scripts/foodNutrition.json');
    return await response.json();
}

async function calculateDailyIntake() {
    const foodNutrition = await loadFoodNutrition();
    const foodInput = document.getElementById('foodInput').value; // 用户输入的食物名称
    const foodQuantity = parseFloat(document.getElementById('foodQuantity').value); // 用户输入的食物数量

    const foodItem = foodNutrition.find(item => item.name === foodInput);

    if (foodItem) {
        const totalCalories = foodItem.calories * foodQuantity; // 计算总卡路里
        const totalCarbs = foodItem.carbs * foodQuantity; // 计算总碳水化合物
        const totalProtein = foodItem.protein * foodQuantity; // 计算总蛋白质
        const totalFat = foodItem.fat * foodQuantity; // 计算总脂肪

        document.getElementById('results').innerText = `
            总热量: ${totalCalories.toFixed(2)} 千卡
            碳水化合物: ${totalCarbs.toFixed(2)} 克
            蛋白质: ${totalProtein.toFixed(2)} 克
            脂肪: ${totalFat.toFixed(2)} 克
        `;
    } else {
        document.getElementById('results').innerText = '未找到该食物的营养信息。';
    }
}

// 绑定事件
document.getElementById('calculateButton').addEventListener('click', calculateDailyIntake);
```

## 界面说明

### 1. 首页
- **布局**: 分为四栏
  - **第一栏**: 显示主食、蛋白质类摄入量，包含计算按钮，弹出表单进行计算并存储结果。
  - **第二栏**: 显示今天摄入的卡路里，计算食物卡路里含量。
  - **第三栏**: 提供"去运动"按钮，跳转到运动页面，记录运动消耗的卡路里。
  - **第四栏**: 显示鼓励的话，计算能量缺口。

### 2. 运动视频列表页
- **功能**: 按照运动类型分类展示视频，以卡片形式呈现，用户可以播放视频并输入自定义链接。

### 3. 我的页面
- **功能**: 待定，后续根据用户反馈进行设计。

## 开发计划
1. **第一部分功能完成**: 目前已完成基础的营养计算和用户输入功能。
2. **后续优化**: 在完成第二部分和第三部分功能后，将回头对第一部分进行优化。
3. **功能实现**: 
   - 实现营养素计算功能。
   - 实现卡路里记录功能。
   - 实现运动视频播放功能。
   - 实现社交功能的基础框架。
   - 实现基础代谢率（BMR）和身体质量指数（BMI）计算功能。
4. **测试**: 进行功能测试和用户体验测试。
5. **部署**: 将项目推送到 GitHub，并在 GitHub Pages 上进行部署。

## 联系方式
如有任何问题或建议，请联系项目维护者。

## 新增功能说明

### 视频列表页面

1. **功能概述**：
   - 读取 `videos.json` 文件中的数据，加载视频信息，并将这些信息渲染到 `videoList.html` 页面中。
   - 解决因同源 CORS 导致的图像、视频资源加载问题。
   - 按照运动类型（热身、有氧、核心、力量、拉伸）对加载的视频进行分类。
   - 动态生成视频卡片，卡片结构包含视频占位符和视频相关的文本输入控件。

2. **视频卡片结构**：
   - **视频占位符**：用于包裹视频缩略图和视频播放器。点击该区域会触发 `playVideo` 函数，开始播放视频。
   - **文本控件**：显示视频标题，用户可以在输入框内输入自定义视频链接，替换原本的视频。提供播放视频和清空输入框的按钮。

3. **页面结构**：
   - **导航**：按照热身、有氧、核心、力量、拉伸等组成。
   - **视频分类**：用于组织视频内容。
   - **视频卡片**：展示每个视频的缩略图、标题和相关操作。

### 代码实现

- 使用 `fetch` API 加载 `videos.json` 文件。
- 使用 DOM 操作动态生成视频卡片。
- 处理 CORS 问题，确保图片和视频资源能够正常加载。



### 视频播放器
- 播放视频，并显示视频的标题、描述、时长、分类���信息。
- 提供播放、暂停、停止、跳转等操作。
- 提供视频的缩略图，点击缩略图会播放视频。
- 提供视频的播放链接，用户可以输入自定义链接，替换原本的视频。 



# TODO

1. 提取json中的steam url，转换为本地。对应修改videoload.js
### 社交功能
- 创建讨论区，用户可以发布和回复帖子，分享减肥经验。社交数据将存储在本地存储中。 
- 用可以收藏、点赞、评论帖子

### 功能二：计算用户每日摄入的卡路里含量

#### 需求讨论总结

1. **用户输入**：
   - 用户需要输入食品名称和克数，并按照餐次进行分类（如早餐、中餐、晚餐、加餐、宵夜），以更符合用户的认知。

2. **输入方式**：
   - 结合文本框和下拉菜单。下拉菜单用于选择食物种类（如碳水、蛋白质、蔬菜等），文本框用于输入具体的食物名称。
   - 另外，提供一个下拉菜单或单选按钮让用户选择餐次（早餐、中餐、晚餐、加餐、宵夜）。

3. **数据源**：
   - 数据源将使用 JSON 文件格式，便于在前端进行处理和查询。
   - 数据来源可以考虑使用公开的食物营养数据库（如 USDA 食品数据库）或手动创建一个包含常见食物的 JSON 文件。

4. **数据格式**：

   `fooddata.json` 文件中的每个食物对象应包含以下字段：

   - **foodName**: 食物名称
   - **calories**: 卡路里（千卡）
   - **protein**: 蛋白质（克）
   - **carbs**: 碳水化合物（克）
   - **fat**: 脂肪（克）
   - **type**: 食物类型（如水果、蔬菜、肉类等）
   - **url**: 食物的相关链接（可选）

5. **计算逻辑**：
   - 用户输入的克数将用于计算营养成分。例如，如果用户输入 200 克，而数据源中提供的是每 100 克的营养成分，则需要将数据源中的值乘以 2（200 克 / 100 克）来得到实际的营养成分。
   计算用户摄入的卡路里和营养成分：
      卡路里 = (食物的卡路里 / 100) 用户输入的数量
      蛋白质 = (食物的蛋白质 / 100) 用户输入的数量
      碳水化合物 = (食物的碳水化合物 / 100) 用户输入的数量
      脂肪 = (食物的脂肪 / 100) 用户输入的数量

6. **实现过程**：
   当用户在食物名称输入框中输入信息时，系统会实时查询 `fooddata.json` 中的相关数据。
   - 查询到的食物信息不再渲染到页面上，而是可以在控制台中输出，以便进行调试。

   添加食物并计算总摄入量
   - 用户可以通过点击"添加食物"按钮将输入的食物名称和数量添加到列表中。
   - 系统会计算所有已添加食物的总摄入量，包括卡路里、蛋白质、碳水化合物和脂肪，并在页面上展示结果。

   ## 使用说明

   1. 输入食物名称和数量。
   2. 点击"添加食物"按钮将食物添加到列表中。
   3. 点击"计算总摄入量"按钮查看总的卡路里和营养成分。

   ## 未来的改进
   - 允许用户输入多种食物并计算总摄入量。
   - 增加历史记录功能，方便用户查看之前的输入和计算结果。
   - 提供清除功能，允许用户清空所有输入和结果。


7. **结果展示**：
   - 计算结果将在页面上以清晰的格式展示，使用圆环比例或百分比的方式进行展示。
   - 展示四个圆环百分比：
     - 总体摄入卡路里
     - 碳水化合物
     - 蛋白质
     - 脂质

8. **错误处理**：
   - **输入验证**：
     - 如果用户输入的食物名称不在数据源中，显示错误消息，例如"未找到该食物的营养信息，请检查输入。"并建议用户选择下拉菜单中的选项。
     - 如果用户输入的克数不是正数或非数字，显示错误消息，例如"请输入有效的克数（正数）。"

9. **用户体验**：
   - **界面设计**：
     - 食物名输入框和克数输入框放在同一行，方便用户输入。
     - 下拉菜单在食物名称输入框旁边，用户可以选择食物种类。
     - 提供明显的"计算"按钮，用户点击后进行计算。
     - 提供一个下拉菜单或单选按钮让用户选择餐次（早餐、中餐、晚餐、加餐、宵夜）。
  
   - **交互反馈**：
     - 在计算过程中显示加载动画，提示用户正在处理请求。
     - 计算完成后，清晰地展示结果，并提供"重新计算"按钮，方便用户进行新的计算。

## 功能更新

### 1. 清晰的输入提示
- 输入框中添加了占位符，提示用户输入格式（如：苹果，100克）。

### 2. 实时反馈
- 用户输入食物名称时，提供实时的搜索建议或下拉列表，显示匹配的食物名称。

### 3. 输入验证
- 在用户点击"添加食物"时，展示用户吃了哪些食物，并提供反馈，确保功能清晰易于理解。

### 4. 结果展示
- 结果展示区域使用表格格式，使信息更加整齐和易读，并使用不同颜色突出显示。

### 5. 查看历史记录
- 允许用户查看之前输入的食物和计算结果，并提供清除历史记录的选项。

### 6. 下拉列表选择功能
- 在输入框中输入食物名称时，系统会显示匹配的食物名称的下拉列表。
- 用户可以通过点击下拉列表中的选项来选择食物，输入框会自动填充所选的食物名称。

### 7. 历史记录以卡片形式展示
- 历史记录现在以卡片的形式呈现，包含食物名称、克数、卡路里、碳水化合物、蛋白质和脂肪的含量。
- 每条记录以卡片的形式展示，使信息更加整齐和易读。

